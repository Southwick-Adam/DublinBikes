<div id="rightSidebar">
    <h2 id="stationName" class="text-2xl font-bold mt-2">Station Name</h2>
    <p id="bikeAvailability" class="text-1xl mt-2">Bikes Available: </p>
    <p id="standAvailability" class="text-1xl mt-2">Stands Available: </p>

    <div class="text-center"> 
        <label for="daySelect" class="block mt-4 font-bold text-center">Select a day to view average bike availability:</label>
        <select id="daySelect" class="block mt-1 mb-4 mx-auto w-64">
            <option>Monday</option>
            <option>Tuesday</option>
            <option>Wednesday</option>
            <option>Thursday</option>
            <option>Friday</option>
            <option>Saturday</option>
            <option>Sunday</option>
        </select>
    </div>

    <div class="p-4" style="height: 400px;">
        <canvas id="bikeAvailabilityChart"></canvas>
    </div>

    <button class="mt-4 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" onclick="closeRightSidebar()">Close</button>
</div>


<script>
    let bikeChart;

    function fetchBikeData() {
        return fetch('bike_data/bike_avg.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Bike Data Unavailable.');
                }
                return response.json(); // Parse JSON data
            })
            .then(data => {
                // If everything is good, you might want to do something with 'data' here
                return data; // Assuming no specific function to send data to, just returning it
            })
            .catch(error => {
                console.error('Error loading bike data:', error); // Send the error to the console
                alert('Error loading bike data: ' + error); // Display alert with error
            });
    }

    function updateBikeUsageData(stationId, selectedDayIndex) {
        fetchBikeData().then(data => {    
            // Convert stationId to string
            const stationKey = stationId.toString(); 
            const bikeData = data[stationKey][selectedDayIndex];
    
            const labels = Array.from({ length: bikeData.length }, (_, i) => `${i}:00`);
            const bikeCtx = document.getElementById('bikeAvailabilityChart').getContext('2d');
    
            if (bikeChart) {
                bikeChart.data.labels = labels;
                bikeChart.data.datasets[0].data = bikeData;
                bikeChart.update();
            } else {
                bikeChart = new Chart(bikeCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Hourly Bike Availability (Avg.)',
                            data: bikeData,
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgb(75, 192, 192)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Hour of the Day'
                                }
                            },
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Bikes Available'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        })
    }    

    function setupDaySelect(stationId) {
        const daySelect = document.getElementById('daySelect');
        daySelect.onchange = () => {
            const selectedDayIndex = daySelect.selectedIndex;
            updateBikeUsageData(stationId, selectedDayIndex);
        };
    }
    window.setupDaySelect = setupDaySelect;
    
    function openRightSidebar(stationId) {
        const stationDict = getStationDict();        
        const sidebar = document.getElementById('rightSidebar');
        const stationName = document.getElementById('stationName');
        const bikeAvailability = document.getElementById('bikeAvailability');
        const standAvailability = document.getElementById('standAvailability');
        const daySelect = document.getElementById('daySelect');
    
        const station = stationDict[stationId];
        stationName.textContent = station.name;
        bikeAvailability.textContent = `Bikes Available: ${station.av_bikes}`;
        standAvailability.textContent = `Stands Available: ${station.av_stands}`;
    
        setupDaySelect(stationId);
        updateBikeUsageData(stationId, daySelect.selectedIndex);
    
        sidebar.style.transform = "translateX(0)";
        sidebar.addEventListener('click', function(event) {
            event.stopPropagation();
        });
    }

    function closeRightSidebar() {
        const sidebar = document.getElementById('rightSidebar');
        sidebar.style.transform = "translateX(100%)";
        if (bikeChart) {
            bikeChart.destroy();
            bikeChart = null;
        }
    }        
</script>

